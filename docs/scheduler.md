# 本地调度器（带前端）

提供一个极简的 Web 前端，控制当前项目 `main.py` 的定时运行：

- 调度模式：
  - 每日固定时刻：
    - 支持 HH:MM 列表（逗号分隔），如 `00:00, 06:30, 12:00`
    - 支持小时范围，如 `6-21点`（含端点，表示 06:00,07:00,...,21:00）
    - 留空=每小时整点
  - 固定间隔（每 1 小时 / 每 30 分钟 / 自定义分钟数≥1）
- 控制：开始/更新定时、停止定时、立即运行一次
- 状态：展示下次运行时间、上次开始/结束时间、退出码与是否在运行
- 日志：`/log` 路由查看尾部日志，完整日志输出在仓库根目录 `scheduler.log`

> 默认行为：如果未设置任何计划，调度器会采用“每日每小时整点”运行。

## 安装依赖

```bash
python -m venv .venv && source .venv/bin/activate
pip install -r requirements.txt
```

## 启动调度器

```bash
python scheduler_app.py
# 默认 http://127.0.0.1:5001

# 自定义端口
SCHEDULER_PORT=5100 python scheduler_app.py
```

打开浏览器访问本地地址，选择频率后点击“开始/更新定时”。

- 如需保存后立刻执行一次，请勾选“保存并立即运行”。
- 未勾选时，将按所选计划的下一次触发时间开始运行。

> 提示：
> - 调度器通过 `sys.executable main.py` 运行当前仓库的入口，不修改原有逻辑。
> - `max_instances=1` 保证不重入，`coalesce=True` 避免堆积。
> - 每日固定时刻模式使用 APScheduler 的 Cron 触发器，每个时刻单独任务以避免 hour/minute 的笛卡尔积。
